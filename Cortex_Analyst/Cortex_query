
------------------------------CORTEX ANALTICS---------------------------


CREATE ROLE CORTEX_LAB; -- CORTEXANALYTICSNEW

USE ROLE ACCOUNTADMIN;

GRANT ROLE ACCOUNTADMIN TO ROLE CORTEX_LAB;

GRANT ROLE CORTEX_LAB TO USER CORTEXANALYTICSNEW;

-- Grant CREATE DATABASE privilege
GRANT CREATE DATABASE ON ACCOUNT TO ROLE CORTEX_LAB;

-- Grant CREATE WAREHOUSE privilege
GRANT CREATE WAREHOUSE ON ACCOUNT TO ROLE CORTEX_LAB;

USE ROLE CORTEX_LAB;

ALTER ACCOUNT SET CORTEX_ENABLED_CROSS_REGION = 'ANY_REGION';  -- for cortex analytics

-- create demo database
CREATE OR REPLACE DATABASE CORTEX_LAB_DB;

-- create schema
CREATE OR REPLACE SCHEMA CORTEX_LAB_SCHEMA;

CREATE OR REPLACE WAREHOUSE CORTEX_LAB_WH WITH
    WAREHOUSE_SIZE='X-SMALL'
    AUTO_SUSPEND = 120
    AUTO_RESUME = TRUE
    INITIALLY_SUSPENDED=TRUE;

USE WAREHOUSE CORTEX_LAB_WH;

CREATE OR REPLACE STAGE CORTEX_STAGE
    DIRECTORY = (ENABLE = TRUE)
    ENCRYPTION = (TYPE = 'SNOWFLAKE_SSE');

list @CORTEX_STAGE;

CREATE OR REPLACE TABLE CORTEX_LAB_DB.CORTEX_LAB_SCHEMA.MEDICAL_BOOKS (
    TITLE STRING,
    AUTHORS STRING,
    DESCRIPTION STRING,
    CATEGORY STRING,
    PUBLISHER STRING,
    PRICE_STARTING_WITH FLOAT,
    PUBLISH_DATE_MONTH STRING,
    PUBLISH_DATE_YEAR INT
);


COPY INTO CORTEX_LAB_DB.CORTEX_LAB_SCHEMA.MEDICAL_BOOKS
FROM @CORTEX_STAGE/Medical_books_clean.csv
FILE_FORMAT = (
    TYPE = 'CSV',
    FIELD_OPTIONALLY_ENCLOSED_BY = '"',
    SKIP_HEADER = 1,
    FIELD_DELIMITER = ',',
    NULL_IF = ('')
)
ON_ERROR = CONTINUE;

select * from MEDICAL_BOOKS;





